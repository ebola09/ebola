<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ebola Arcade</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d0502;
            --text-color: #ff7b00;
            --link-color: #7A3307;
            --link-hover-color: #ff7b00;
            --card-border-color: #210D00;
            --card-overlay-color: rgba(33, 13, 0, 0.75);
            --bottombar-border-color: #7A3307;
            --bottombar-opacity: 0.6;
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'IBM Plex Mono', monospace;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 90px 0 40px;
            user-select: none;
        }

        input, textarea { user-select: text; }
        img { pointer-events: none; user-drag: none; }

        .topbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            font-size: 20px;
            height: 90px;
            background-color: var(--bg-color);
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--bottombar-border-color);
        }

        .topbar a {
            color: var(--link-color);
            text-decoration: none;
            margin-right: 20px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .topbar a:hover,
        .topbar a.active,
        .topbar a.settings-open {
            color: var(--link-hover-color);
        }

        .topbar .logo img {
            height: 60px;
            object-fit: contain;
            user-select: none;
        }

        .grid-section {
            max-width: 1200px;
            margin: 40px auto 0;
            padding: 0 40px;
        }

        .grid-title {
            color: var(--link-color);
            font-size: 14px;
            margin-bottom: 20px;
            text-transform: lowercase;
        }

        #recentlyPlayedGrid,
        #gameGrid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 30px;
        }

        .card {
            width: 100%;
            aspect-ratio: 1/1;
            background-size: cover;
            background-position: center;
            border-radius: 4px;
            border: 2px solid var(--card-border-color);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, border-color 0.2s;
        }

        .card::after {
            content: attr(data-title);
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 16px;
            color: var(--text-color);
            background: rgba(0,0,0,0);
            opacity: 0;
            transition: background 0.2s, opacity 0.2s;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card:hover::after {
            background: var(--card-overlay-color);
            opacity: 1;
        }

        .bottombar {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            opacity: var(--bottombar-opacity);
            padding: 10px 40px;
            border-top: 1px solid var(--bottombar-border-color);
            font-size: 16px;
        }

        .settings-panel {
            position: fixed;
            top: 120px;
            right: 40px;
            width: 220px;
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 2px solid var(--card-border-color);
            border-radius: 4px;
            padding: 20px;
            display: none;
            z-index: 2000;
            opacity: 0.95;
        }

        .settings-panel h3 {
            margin: 0 0 15px;
            font-size: 18px;
            border-bottom: 1px solid var(--bottombar-border-color);
            padding-bottom: 6px;
        }

        .settings-panel label,
        .settings-panel select,
        .settings-panel button {
            display: block;
            width: 100%;
            margin-bottom: 15px;
            font-family: 'IBM Plex Mono', monospace;
        }

        .settings-panel select,
        .settings-panel button {
            padding: 6px 8px;
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--card-border-color);
            border-radius: 3px;
            cursor: pointer;
        }

        .settings-panel button:hover {
            background-color: var(--card-overlay-color);
            border-color: var(--link-hover-color);
        }

        @media (max-width: 1200px) { #gameGrid, #recentlyPlayedGrid { grid-template-columns: repeat(4, 1fr); } }
        @media (max-width: 992px)  { #gameGrid, #recentlyPlayedGrid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 768px)  { #gameGrid, #recentlyPlayedGrid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 500px)  { #gameGrid, #recentlyPlayedGrid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="topbar">
        <div class="left">
            <a href="#" class="active">arcade</a>
            <a href="#">more coming soon</a>
        </div>
        <div class="logo">
            <img src="assets/logos/orangeLogo.png" alt="logo">
        </div>
        <div class="right">
            <a id="settingsButton">settings</a>
        </div>
    </div>

    <div class="grid-section">
        <h2 class="grid-title">recently played</h2>
        <div id="recentlyPlayedGrid"></div>
    </div>

    <div class="grid-section">
        <h2 class="grid-title">all games</h2>
        <div id="gameGrid"></div>
    </div>

    <div class="bottombar">version 1.1</div>

    <div id="settingsPanel" class="settings-panel">
        <h3>settings</h3>
        <label for="themeSelect">theme:</label>
        <select id="themeSelect">
            <option value="orange">orange</option>
            <option value="purple">purple</option>
            <option value="green">green</option>
        </select>
        <button id="exportProgress">export game progress</button>
        <button id="importProgress">import game progress</button>
        <input type="file" id="importFile" accept=".json" style="display:none;">
    </div>

    <script>
        const MAX_RECENT = 5;
        const recentlyPlayedGrid = document.getElementById("recentlyPlayedGrid");
        const gameGrid = document.getElementById("gameGrid");
        const settingsButton = document.getElementById("settingsButton");
        const settingsPanel = document.getElementById("settingsPanel");
        const themeSelect = document.getElementById("themeSelect");
        const importButton = document.getElementById("importProgress");
        const importFile = document.getElementById("importFile");

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            return parts.length === 2 ? parts.pop().split(';').shift() : null;
        }
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + days*24*60*60*1000);
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = `${name}=${value}${expires}; path=/`;
        }

        function getRecentlyPlayed() {
            const cookie = getCookie("recentlyPlayed");
            if (!cookie) return [];
            try { return JSON.parse(cookie); } catch { return []; }
        }

        function saveRecentlyPlayed(games) {
            setCookie("recentlyPlayed", JSON.stringify(games), 30);
        }

        function updateRecentlyPlayedUI(games) {
            recentlyPlayedGrid.innerHTML = "";
            if (!games.length) {
                recentlyPlayedGrid.innerHTML = "<p style='color: var(--link-color);'>you haven't played any games yet :(</p>";
                return;
            }
            games.forEach(game => {
                const card = document.createElement("a");
                card.href = game.path || "#";
                card.className = "card";
                card.style.backgroundImage = `url('${game.thumbnail || ""}')`;
                card.setAttribute("data-title", game.name || "Untitled");
                recentlyPlayedGrid.appendChild(card);
            });
        }

        function addRecentlyPlayed(game) {
            const recent = getRecentlyPlayed().filter(g => g.name !== game.name);
            recent.unshift(game);
            if (recent.length > MAX_RECENT) recent.pop();
            saveRecentlyPlayed(recent);
            updateRecentlyPlayedUI(recent);
        }

        document.addEventListener("DOMContentLoaded", () => updateRecentlyPlayedUI(getRecentlyPlayed()));

        if (!localStorage.getItem("gameProgress")) localStorage.setItem("gameProgress", "{}");

        document.getElementById("exportProgress").addEventListener("click", () => {
            const blob = new Blob([localStorage.getItem("gameProgress") || "{}"], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "ebola_game_progress.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        importButton.addEventListener("click", () => importFile.click());
        importFile.addEventListener("change", e => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                try {
                    localStorage.setItem("gameProgress", JSON.stringify(JSON.parse(reader.result)));
                    alert("Game progress imported successfully!");
                } catch {
                    alert("Invalid JSON file. Please select a valid game progress file.");
                }
            };
            reader.readAsText(file);
            e.target.value = "";
        });

        function setTheme(theme) {
            const root = document.documentElement;
            const colors = {
                orange: {
                    bg: "#0d0502", text: "#ff7b00", link: "#7A3307", hover: "#ff7b00",
                    border: "#210D00", overlay: "rgba(33, 13, 0, 0.75)", bottomBorder: "#7A3307", opacity: 0.6,
                    logo: "assets/logos/orangeLogo.png"
                },
                purple: {
                    bg: "#0D0012", text: "#A70EE8", link: "#5A077D", hover: "#A70EE8",
                    border: "#310046", overlay: "rgba(49,0,70,0.75)", bottomBorder: "#A70EE8", opacity: 0.6,
                    logo: "assets/logos/purpleLogo.png"
                },
                green: {
                    bg: "#000000", text: "#0EE811", link: "#077408", hover: "#0EE811",
                    border: "#077408", overlay: "rgba(7,116,8,0.75)", bottomBorder: "#0EE811", opacity: 0.6,
                    logo: "assets/logos/greenLogo.png"
                }
            };
            const c = colors[theme];
            root.style.setProperty('--bg-color', c.bg);
            root.style.setProperty('--text-color', c.text);
            root.style.setProperty('--link-color', c.link);
            root.style.setProperty('--link-hover-color', c.hover);
            root.style.setProperty('--card-border-color', c.border);
            root.style.setProperty('--card-overlay-color', c.overlay);
            root.style.setProperty('--bottombar-border-color', c.bottomBorder);
            root.style.setProperty('--bottombar-opacity', c.opacity);
            document.querySelector('.topbar .logo img').src = c.logo;
            setCookie("theme", theme, 30);
        }

        const savedTheme = getCookie("theme");
        if (savedTheme) { setTheme(savedTheme); themeSelect.value = savedTheme; }

        settingsButton.addEventListener("click", () => {
            const isOpen = settingsPanel.style.display === "block";
            settingsPanel.style.display = isOpen ? "none" : "block";
            settingsButton.classList.toggle('settings-open', !isOpen);
        });

        themeSelect.addEventListener("change", () => setTheme(themeSelect.value));

        fetch("gameList.json")
            .then(res => res.json())
            .then(data => {
                if (!data.games?.length) {
                    gameGrid.innerHTML = `<p style="color: var(--text-color);">No games found. Check gameList.json.</p>`;
                    return;
                }
                data.games.sort((a,b) => (a.name||"").toLowerCase().localeCompare((b.name||"").toLowerCase()));
                data.games.forEach(game => {
                    const card = document.createElement("a");
                    card.href = game.path || "#";
                    card.className = "card";
                    card.style.backgroundImage = `url('${game.thumbnail||""}')`;
                    card.setAttribute("data-title", game.name || "Untitled");
                    card.addEventListener("click", () => addRecentlyPlayed(game));
                    gameGrid.appendChild(card);
                });
            })
            .catch(err => {
                gameGrid.innerHTML = `<p style="color: var(--text-color);">Failed to load gameList.json</p>`;
                console.error("Error loading game list:", err);
            });
    </script>
</body>
</html>
