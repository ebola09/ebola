<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ebola tv</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.png">
    <link rel="stylesheet" href="../css/themes.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/components.css">
    <script src="../js/themes.js"></script>

    <script>
        async function loadPartials() {
            try {
                const [topbar, bottombar, settings] = await Promise.all([
                    fetch('../partials/topbar.html').then(res => res.text()),
                    fetch('../partials/bottombar.html').then(res => res.text()),
                    fetch('../partials/settings.html').then(res => res.text())
                ]);
                document.getElementById('topbar-placeholder').innerHTML = topbar;
                document.getElementById('bottombar-placeholder').innerHTML = bottombar;
                document.getElementById('settingsPanel').innerHTML = settings;
                initApp();
            } catch (err) {
                console.error('Error loading partials:', err);
                
            }
        }

        loadPartials();
    </script>
</head>

<body>

<div id="topbar-placeholder"></div>

<div class="main-content">
    <div class="games-container">
        <div class="grid-section">
            <div class="grid-title-container">
                <h2 class="grid-title">top results</h2>
                    <input type="text" class="search-input" id="tvSearch" placeholder="search">
            </div>
            <div id="tvGrid"></div>
        </div>

        <div class="grid-section">
        </div>
        </div>
    </div>
</div>

<div id="bottombar-placeholder"></div>
<div id="settingsPanel"></div>

<script>
function initApp() {
    const tvGrid = document.getElementById('tvGrid');
    const recentlyPlayedGrid = document.getElementById('recentlyPlayedGrid');
    const tvSearch = document.getElementById('tvSearch');
    const mainContent = document.querySelector('.main-content');

    /* Helper: extract IMDb ID from URL */
    function getImdbId() {
        const pathParts = window.location.pathname.split('/');
        // e.g., ['', 'tv', 'tt0816692']
        return pathParts.length === 3 && pathParts[2].startsWith('tt') ? pathParts[2] : null;
    }

    const imdbId = getImdbId();

    /* If IMDb ID is present, show title + empty canvas */
    if (imdbId) {
        mainContent.innerHTML = `
            <div class="imdb-page">
                <h1 id="imdbTitle">Loading...</h1>
                <canvas id="imdbCanvas" width="800" height="600" style="border:1px solid var(--text-color);"></canvas>
            </div>
        `;

        /* Optionally, fetch IMDb title using TMDB (since you have /api/tmdb) */
        (async () => {
            try {
                const res = await fetch(`/api/tmdb?endpoint=find/${imdbId}&external_source=imdb_id`);
                const data = await res.json();
                // TMDB returns results in `tv_results` or `movie_results`
                const result = data.tv_results?.[0] || data.movie_results?.[0];
                if (result) {
                    document.getElementById('imdbTitle').textContent = result.name || result.title;
                } else {
                    document.getElementById('imdbTitle').textContent = 'Title not found';
                }
            } catch (err) {
                console.error(err);
                document.getElementById('imdbTitle').textContent = 'Error loading title';
            }
        })();

        return; // Skip the rest of initApp for IMDb page
    }

    /* =======================
       Normal /tv/ page below
       ======================= */
    async function fetchTV(endpoint) {
        const res = await fetch(`/api/tmdb?endpoint=${endpoint}`);
        const data = await res.json();
        return data.results;
    }

    function displayTVShows(shows, gridElement) {
        gridElement.innerHTML = '';
        if (!shows || shows.length === 0) {
            gridElement.innerHTML = '<p style="color: var(--text-color);">nothing to see here...</p>';
            return;
        }
        shows.forEach(show => {
            if (!show.poster_path) return;
            const card = document.createElement('div');
            card.className = 'tv-card';
            card.style.backgroundImage = `url('https://image.tmdb.org/t/p/w500${show.poster_path}')`;
            card.innerHTML = `
                <div class="tv-title">${show.name}</div>
                <div class="tv-rating">â˜… ${show.vote_average.toFixed(1)}</div>
            `;
            gridElement.appendChild(card);
        });
    }

    // Rest of your theme, settings, topbar highlight, trending & search code
    // ...
}
</script>



</body>
</html>
